<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lost Item Registration</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    form { max-width: 400px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, button { width: 100%; padding: 10px; margin-top: 5px; border:1px solid #ccc; border-radius:5px;}
    button { background:#004080; color:white; cursor:pointer; }
    #qrContainer { text-align:center; margin-top:20px; }
    #emailNotice { color:green; font-weight:bold; text-align:center; margin-top:10px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ccc; padding:5px; text-align:left; }
    th { background:#004080; color:white; }
  </style>
</head>
<body>

<h1>Register Lost Item</h1>

<form id="registerForm">
  <label>Full Name</label>
  <input type="text" id="name" required>

  <label>University Email</label>
  <input type="email" id="email" placeholder="name@universityofbohol.edu.ph" required>

  <label>Item Name</label>
  <input type="text" id="item" required>

  <button type="submit">Register</button>
</form>

<div id="qrContainer"></div>
<p id="emailNotice"></p>

<h2>Posted Items</h2>
<div id="postedItems"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAgDbyZ5koffA_M60oS9x6aaI_UyViLZVw",
    authDomain: "lost-item-qr.firebaseapp.com",
    databaseURL: "https://lost-item-qr-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "lost-item-qr",
    storageBucket: "lost-item-qr.firebasestorage.app",
    messagingSenderId: "1026817510307",
    appId: "1:1026817510307:web:9a67340577a04797912816",
    measurementId: "G-QY02LG8PCX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // QR code generator (placeholder)
  function generateQR(text, size=150){
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width=canvas.height=size;
    ctx.fillStyle="white"; ctx.fillRect(0,0,size,size);
    ctx.fillStyle="black"; ctx.font="14px Arial";
    ctx.fillText("QR for:",10,20);
    ctx.fillText(text,10,40);
    return canvas;
  }

  // Register form
  document.getElementById("registerForm").addEventListener("submit", function(e){
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const item = document.getElementById("item").value.trim();

    if(!email.endsWith("@universityofbohol.edu.ph")){
      alert("‚ùå Please use your University of Bohol email.");
      return;
    }

    const id = Date.now();
    const newItem = { id, name, email, item, status:"Pending" };

    db.ref("lostItems/"+id).set(newItem)
      .then(()=>{
        const qrLink = window.location.origin + "/item.html?item=" + id;
        const qr = generateQR(qrLink);
        const container = document.getElementById("qrContainer");
        container.innerHTML="<h3>Your QR Code:</h3>";
        container.appendChild(qr);

        document.getElementById("emailNotice").innerText = `üìß Confirmation email sent to ${email} (simulated).`;
        document.getElementById("registerForm").reset();

        // Update posted items table
        displayPostedItems();
      })
      .catch(err => alert("‚ùå Error: "+err));
  });

  // Display all posted items
  function displayPostedItems() {
    const container = document.getElementById("postedItems");
    container.innerHTML = "<p>Loading items...</p>";

    db.ref("lostItems").once("value", snapshot => {
      container.innerHTML = "";
      const items = snapshot.val();
      if (!items) {
        container.innerHTML = "<p>No items posted yet.</p>";
        return;
      }

      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>Item Name</th>
          <th>Owner</th>
          <th>Status</th>
          <th>View</th>
        </tr>
      `;

      Object.values(items).forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.item}</td>
          <td>${item.name}</td>
          <td>${item.status}</td>
          <td><a href="item.html?item=${item.id}">View</a></td>
        `;
        table.appendChild(tr);
      });

      container.appendChild(table);
    });
  }

  // Load posted items on page load
  displayPostedItems();
</script>

</body>
</html>
