<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Item Details</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #itemDetails { max-width: 500px; margin: auto; border: 1px solid #ccc; padding: 20px; border-radius: 5px; }
    button { background:#004080; color:white; padding:10px; border:none; border-radius:5px; cursor:pointer; margin-top:10px; }
    p { margin: 5px 0; }
  </style>
</head>
<body>

<h1>Item Details</h1>
<div id="itemDetails">
  <p><strong>Item Name:</strong> <span id="itemName"></span></p>
  <p><strong>Owner Name:</strong> <span id="ownerName"></span></p>
  <p><strong>Status:</strong> <span id="itemStatus"></span></p>
  <button id="reportFoundBtn">Report Found</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAgDbyZ5koffA_M60oS9x6aaI_UyViLZVw",
    authDomain: "lost-item-qr.firebaseapp.com",
    databaseURL: "https://lost-item-qr-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "lost-item-qr",
    storageBucket: "lost-item-qr.firebasestorage.app",
    messagingSenderId: "1026817510307",
    appId: "1:1026817510307:web:9a67340577a04797912816",
    measurementId: "G-QY02LG8PCX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Get item ID from URL
  const params = new URLSearchParams(window.location.search);
  const itemId = params.get('item');

  if(!itemId) {
    alert("Invalid QR code or URL.");
    document.getElementById("itemDetails").style.display = "none";
  } else {
    const itemRef = db.ref("lostItems/" + itemId);
    itemRef.once("value", snapshot => {
      const item = snapshot.val();
      if(!item) {
        alert("Item not found in database.");
        document.getElementById("itemDetails").style.display = "none";
      } else {
        document.getElementById("itemName").innerText = item.item;
        document.getElementById("ownerName").innerText = item.name;
        document.getElementById("itemStatus").innerText = item.status;

        // Report found button
        const btn = document.getElementById("reportFoundBtn");
        if(item.status === "Found") {
          btn.disabled = true;
          btn.innerText = "Already Reported";
        } else {
          btn.addEventListener("click", () => {
            itemRef.update({status: "Found"})
              .then(() => {
                alert("✅ Item status updated to Found.");
                document.getElementById("itemStatus").innerText = "Found";
                btn.disabled = true;
                btn.innerText = "Already Reported";
              })
              .catch(err => alert("❌ Error: " + err));
          });
        }
      }
    });
  }
</script>

</body>
</html>
